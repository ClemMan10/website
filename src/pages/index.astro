---
import Navbar from "../components/Navbar.astro";
import Video from "../components/Video.astro";
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const data = await getCollection("videos");
---

<style lang="scss">
  @use "bulma/sass/layout/hero";
  @use "bulma/sass/layout/container";
  @use "bulma/sass/elements/title";

  .cover-image {
    background:
      linear-gradient(0deg, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 1) 100%),
      url("/cover.jpg") center/cover;
    text-align: center;
    font-weight: 700;

    h1,
    h2 {
      color: white;
    }
  }

  .videos-wrapper {
    .videos {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      transition: max-height 0.5s ease;
    }

    /* Par d√©faut on masque clairement le bouton (redondance CSS) */
    .toggle-videos {
      display: none !important;
      margin-top: 1rem;
      padding: 0.5rem 0.75rem;
      // background-color: #222;
      background: linear-gradient(45deg, #ea475f, #92dbf5);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      transition: background-color 0.2s ease;
    }

    .toggle-videos:hover {
      background-color: #444;
    }
  }

  /* Mobile : collapse et bouton visible */
  @media (max-width: 768px) {
    .videos-wrapper .videos {
      max-height: calc(3 * 180px + 1.5rem * 2); /* 3 vid√©os + gaps */
      overflow: hidden;
    }

    .videos-wrapper .videos.expanded {
      max-height: 1000px; /* assez grand pour toutes les vid√©os */
    }

    .videos-wrapper .toggle-videos {
      display: flex !important; /* visible uniquement sur mobile */
    }
  }
</style>

<Layout>
  <Navbar slot="navbar" />

  <!-- Cover modifi√©e -->
  <div class="hero cover-image">
    <div class="container hero-body">
      <h1 class="title">IN THE POUCHETT</h1>
      <h2 class="subtitle">Enregistrements, Mixages, Live Sessions</h2>
    </div>
  </div>

  <style lang="scss">
    .cover-image {
      background:
        linear-gradient(0deg, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 1) 100%),
        url("/cover.jpg") center/cover;
      text-align: center;
      font-weight: 700;

      /* Hauteur 3/4 sur desktop */
      min-height: 75vh;

      h1,
      h2 {
        color: white;
      }

      /* Centrage vertical Bulma-friendly */
      .hero-body {
        display: flex;
        flex-direction: column;
        justify-content: center; /* centre verticalement */
        align-items: center; /* centre horizontalement */
      }
        /* Ajustement des tailles de texte */
      .title {
        font-size: 4rem; /* Taille principale */
        line-height: 1.1;
      }

      .subtitle {
        font-size: 2rem;
        font-weight: 400;
        margin-top: 0.5rem;
      }
    }

    /* Mobile portrait : cover plus petite */
    @media (max-width: 768px) and (orientation: portrait) {
      .cover-image {
        min-height: 33vh; /* 1/3 de l'√©cran */
      }
      .title {
       font-size: 2.5rem !important;
      }

      .subtitle {
        font-size: 1.5rem !important;
      }
    }

    .studio-wrapper {
      width: 100%;

      .studio-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        grid-auto-rows: 200px; /* hauteur de chaque ligne */
        gap: 0.75rem;
        transition: max-height 0.5s ease;
        grid-auto-flow: dense;
      }

      .studio-item {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        cursor: pointer;
        z-index: 1;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.5s ease, transform 0.5s ease;

        &.wide { 
          grid-column: span 2;
        }
        
        &.tall { 
          grid-row: span 2;
        }
        
        &.visible {
          opacity: 1;
          transform: translateY(0);
        }
        
        img {
          width: 100%;
          height: 100%;
          display: block;
          object-fit: cover;
          object-position: center center; /* Par d√©faut centr√© */
          border-radius: 8px;
          transition: transform 0.3s ease;
        }

        &:hover img {
          transform: scale(1.05);
        }

        .caption {
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background: rgba(0, 0, 0, 0.6);
          color: white;
          text-align: center;
          padding: 0.5rem;
          opacity: 0;
          transition: opacity 0.3s ease;
        }

        &:hover .caption {
          opacity: 1;
        }
      }

      .toggle-studio {
        display: none; /* par d√©faut desktop */
        margin-top: 1rem;
        padding: 0.5rem 0.75rem;
        background: linear-gradient(45deg, #ea475f, #92dbf5);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.25rem;
        transition: background-color 0.2s ease, transform 0.2s ease;

        &:hover {
          transform: scale(1.1);
          background: linear-gradient(45deg, #d03f54, #7ec8e2);
        }

        i {
          transition: transform 0.3s ease;
        }

        &.expanded i {
          transform: rotate(45deg); /* effet + -> √ó */
        }
      }

      @media (max-width: 768px) {
        .toggle-studio {
          display: flex;
        }
        .studio-gallery {
          grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
          grid-auto-rows: 160px; /* hauteur de base plus petite */
        }

        /* ‚úÖ Les ‚Äúwide‚Äù restent plus larges, mais s‚Äôadaptent s‚Äôil n‚Äôy a pas la place */
        .studio-item.wide {
          grid-column: span 2;
        }

        /* ‚úÖ Les ‚Äútall‚Äù gardent une vraie hauteur, sans √™tre trop fines */
        .studio-item.tall {
          grid-row: span 2;
          grid-auto-rows: auto;
        }

        /* ‚úÖ Emp√™che les tr√®s grandes tall d‚Äô√™tre trop √©troites quand en 2 colonnes */
        .studio-item.tall img {
          object-fit: cover;
          object-position: center top;
        }

        /* ‚úÖ Optionnel : espacement un peu r√©duit */
        .studio-gallery {
          gap: 0.5rem;
        }
      }

      @media (max-width: 768px) {
        .studio-item:nth-child(n + 7) {
          display: none;
        }

        .studio-gallery.expanded .studio-item:nth-child(n + 7) {
          display: block;
          animation: fadeInUp 0.5s ease forwards;
        }

        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      }

      /* === Desktop : bouton cach√© === */
      @media (min-width: 769px) {
        .toggle-studio {
          display: none;
        }
      }

      /* Animation fluide pour l'expansion */
      .studio-wrapper .studio-gallery {
        max-height: 1000px;
        overflow: hidden;
        transition: max-height 0.6s ease;
      }

      @media (max-width: 768px) {
        .studio-wrapper .studio-gallery {
          max-height: 600px; /* visible part */
        }

        .studio-wrapper .studio-gallery.expanded {
          max-height: 3000px; /* s'ouvre doucement */
        }
      }

    }

    /* Lightbox plein √©cran */
    #lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8); /* un peu plus transparent */
      display: none;       /* cach√© par d√©faut */
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
      box-sizing: border-box;
      flex-direction: column; /* image + l√©gende en colonne */
      text-align: center;     /* centre le texte */
    }

    #lightbox.active {
      display: flex;
    }

    #lightbox img {
      max-width: 90%;
      max-height: 80vh;
      border-radius: 8px;
      margin-bottom: 10px; /* espace entre image et l√©gende */
    }

    #lightbox .lightbox-caption {
      color: #fff;
      font-size: 1rem;
    }

    /* Croix de fermeture */
    #lightbox .close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 30px;
      color: #fff;
      cursor: pointer;
      z-index: 10000; /* toujours au-dessus */
    }

    /* üí° Ajuste les marges lat√©rales du studio sur desktop */
    #studio,
    .studio-section {
      grid-template-columns: 0.5rem minmax(0, 1fr) 0.5rem; /* Base mobile */
    }

    @media (min-width: 1024px) {
      #studio,
      .studio-section {
        grid-template-columns: 0.5rem minmax(0, 5fr) 0.5rem; /* √©largit le contenu */
      }
    }
    

  </style>

  <section class="pattern">
    <div class="container">
      <p>
        Situ√©s dans le 17√®me arrondissement de Paris, le studio In the Pouchett
        vous accueille pour accompagner vos projets musicaux. Studio orient√©
        autour des Live Sessions, nous proposons cependant des services plus
        classiques tels que l'enregistrement, le mixage et le mastering de vos
        titres.
      </p>
      <p>
        Nous pouvons √©galement apporter notre expertise musicale pour vous aider
        dans vos compositions et vous proposer des musiciens de session
        d'exception.
      </p>
    </div>
  </section>

  <!-- Section R√©f√©rences avec collapse sur mobile -->
  <section class="filled" id="reference">
    <h1>R√©f√©rences</h1>
    <div class="container">
      <div class="videos-wrapper">
        <div class="videos">
          {data.map((i) => <Video url={i.data.url} />)}
        </div>

        <!--
          Bouton REELLEMENT masqu√© par d√©faut via inline style.
          Le script ci-dessous l'affichera uniquement si l'√©cran est mobile.
        -->
        <button class="toggle-videos" style="display:none;" aria-hidden="true">
          <i class="fa-solid fa-plus" aria-hidden="true"></i>
        </button>
      </div>

      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus.
        Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies
        sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius
        a, semper congue, euismod non, mi.
      </p>
    </div>
  </section>

  <h1 class="pattern" id="studio">Le studio</h1>
  <section class="filled studio-section">
    <div class="container">
      <p>
        D√©couvrez notre studio √† travers ces images : ambiance, mat√©riel et espace de travail.
      </p>

      <!-- Ajout de studio-wrapper -->
      <div class="studio-wrapper">
        <div class="studio-gallery">
          <div class="studio-item tall">
            <img src="/studio_large_portrait.jpg" alt="Vue g√©n√©rale du studio" />
            <div class="caption">Vue g√©n√©rale du studio</div>
          </div>
          <div class="studio-item tall wide">
            <img src="/piano_close.jpg" alt="Piano acoustique" />
            <!-- <div class="caption">Console de mixage</div> -->
          </div>
          <div class="studio-item">
            <img src="/fader.jpg" alt="Fader" />
            <!-- <div class="caption">Cabine d'enregistrement</div> -->
          </div>
          <div class="studio-item">
            <img src="/piano1.jpg" alt="Piano droit" />
            <div class="caption">Piano droit</div>
          </div>
          <div class="studio-item tall">  
            <img src="/oc818.jpg" alt="Austrian Audio OC818" />
            <!-- <div class="caption">Espace d'accueil</div> -->
          </div>
          <div class="studio-item tall wide">
            <img src="/flamand-cache.jpg" alt="Flamand Rose" style="object-position: 50% 30%;" />
            <!-- <div class="caption">Espace d'accueil 2</div> -->
          </div>
          <div class="studio-item">
            <img src="/d190-mic.jpg" alt="AKG D190C" style="object-position: 50% 10%;" />
            <!-- <div class="caption">Instruments et mat√©riel 2</div> -->
          </div>
          <div class="studio-item tall">
            <img src="/soyuz-013.jpg" alt="Soyuz 013 fet" />
            <!-- <div class="caption">Instruments et mat√©riel 3</div> -->
          </div>
          <div class="studio-item wide">
            <img src="/machine_patchbay.jpg" alt="Control Room" />
            <div class="caption">Control Room</div>
          </div>
          <div class="studio-item tall">
            <img src="/close_mic_green.jpg" alt="Prise de son" />
            <div class="caption">Prise de son</div>
          </div>
          <div class="studio-item">
            <img src="/bureau_large.jpg" alt="Bureau Studio" />
            <div class="caption">Bureau Studio</div>
          </div>
        </div>

        <!-- Bouton voir plus -->
        <button class="toggle-studio" aria-label="Voir plus">
          <i class="fa-solid fa-plus"></i>
        </button>
      </div>
    </div>
  </section>

  <!-- Lightbox Overlay -->
  <div id="lightbox" class="lightbox">
    <span class="close">&times;</span>
    <img class="lightbox-img" src="" alt="Aper√ßu studio" />
    <div class="lightbox-caption"></div>
  </div>


<h1 class="pattern" id="materiel">Le mat√©riel</h1>
<section class="filled materiel-section">
  <div class="container">
    <div class="materiel-grid">
      <!-- Colonne 1: Monitoring -->
      <div class="materiel-category">
        <h2>Monitoring / AD-DA / DAW</h2>
        <ul>
          <li>RME Fireface UFXIII</li>
          <li>Trinnov Nova</li>
          <li>Kali Audio IN-8 V2</li>
          <li>Reaper 7</li>
        </ul>
      </div>

      <!-- Colonne 2: Headphones -->
      <div class="materiel-category">
        <h2>Headphones</h2>
        <ul>
          <li>Neumann NDH30</li>
          <li>Beyerdynamic DT 990 Pro</li>
          <li>Sony MDR-7506</li>
          <li>AKG K92</li>
          <li>Audio-Technica ATH-M50x</li>
          <li>Presonus HP60</li>
        </ul>
      </div>

      <!-- Colonne 3: Pr√©amplis / DYN -->
      <div class="materiel-category">
        <h2>Pr√©amplifieurs / DYN</h2>
        <ul>
          <li>Focusrite ISA Two</li>
          <li>Audient ASP800/880</li>
          <li>RME Fireface UFX III</li>
          <li>Focusrite Scarlett 18i20</li>
        </ul>
      </div>

      <!-- Colonne 4: Microphones -->
      <div class="materiel-category">
        <h2>Microphones</h2>
        <ul>
          <li>AEA R84</li>
          <li>AKG D190C</li>
          <li>Aston Origin</li>
          <li>Austrian Audio OC818</li>
          <li>Lewitt LCT 40 x 2</li>
          <li>Sennheiser MD421</li>
          <li>Shure SM7B, SM57</li>
          <li>Soyuz 013FET x2</li>
        </ul>
      </div>

      <!-- Colonne 5: Direct Boxes -->
      <div class="materiel-category">
        <h2>Direct Boxes</h2>
        <ul>
          <li>Radial JDI, J48, Pro D2</li>
          <li>Samson S-direct</li>
        </ul>
      </div>

      <!-- Images √©quipement -->
      <div class="materiel-images instrument-carousel">
        <img src="/hardware_close_blur.jpg" alt="Studio Hardware" />
        <img src="/soyuz_013_close.jpg" alt="Micros Soyuz" style="object-position: 50% 25%;" />
        <img src="/fader.jpg" alt="Amplis Orange" />
      </div>

      <!-- Colonne 6: Instruments avec toutes les sous-cat√©gories -->
      <div class="materiel-category instruments">
        <h2>Instruments</h2>
        <div class="instrument-group">
          <h3>Guitars / Basses</h3>
          <ul>
            <li>Marcus Miller V7 Swamp Ash NT</li>
            <li>Epiphone Guitare folk</li>
            <li>Paul Beuscher 1950 Guitare classique</li>
          </ul>
        </div>

        <div class="instrument-group">
          <h3>Synth√©tiseurs</h3>
          <ul>
            <li>Behringer DeepMind</li>
            <li>Behringer RD8</li>
            <li>Korg Modwave</li>
          </ul>
        </div>

        <div class="instrument-group">
          <h3>Claviers / Piano</h3>
          <ul>
            <li>Gunther Piano droit</li>
            <li>Yamaha CK61</li>
          </ul>
        </div>

        <div class="instrument-group">
          <h3>Amps / Cabs</h3>
          <ul>
            <li>Tech 21 Sans Amp rack</li>
            <li>Peavey Valveking 112</li>
          </ul>
        </div>

        <div class="instrument-group">
          <h3>Percussions</h3>
          <ul>
            <li>Claves</li>
            <li>Udu</li>
            <li>Kalimba</li>
            <li>Shakers</li>
          </ul>
        </div>
      </div>

      <!-- Colonne 7: Plugins -->
      <div class="materiel-category">
        <h2>Plugins</h2>
        <ul>
          <li>FabFilter</li>
          <li>Waves</li>
          <li>iZotope</li>
          <li>Antares Autotune</li>
          <li>Melodyne</li>
          <li>Arturia</li>
          <li>Soundtoys</li>
          <li>Plugin Alliance</li>
          <li>Toontrack SD5</li>
          <li>UAD</li>
        </ul>
      </div>

      <!-- Images √©quipement 2 -->
      <div class="materiel-images-bottom instrument-carousel">
        <img src="/piano_close_right.jpg" alt="Piano du studio" />
        <img src="/deepmind_close.jpg" alt="Synth√© deepmind" style="object-position: 50% 90%;" />
        <img src="/guitare_acoustique.jpg" alt="Guitare acoustique" style="object-position: 50% 40%;"/>
      </div>
    </div>
  </div>
</section>

<style lang="scss">
  .materiel-section {
    .materiel-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem 1.5rem;
      margin-top: 1.5rem;
    }

    .materiel-category {
      h2 {
        font-size: 1rem;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 0.75rem;
        color: white;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding-bottom: 0.25rem;
      }

      h3 {
        font-size: 0.9rem;
        font-weight: 600;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
        color: rgba(255, 255, 255, 0.9);
      }

      ul {
        list-style: none;
        padding: 0;
        margin: 0;

        li {
          font-size: 0.85rem;
          line-height: 1.6;
          color: rgba(255, 255, 255, 0.85);
          margin-bottom: 0.25rem;
          padding-left: 0;
        }
      }
    }

    .materiel-category.instruments {
      grid-column: span 2;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      /* vertical | horizontal */
      gap: 0.75rem 3rem; /* üëà r√©duit l'espace vertical */
      align-items: start;

      h2 {
        grid-column: 1 / -1;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 1rem;
        padding-bottom: 0.25rem;
      }

      .instrument-group {
        break-inside: avoid;
        margin: 0; /* retire tout margin interne */
      }

      h3 {
        margin: 0 0 0.25rem 0;
      }

      ul {
        margin: 0;
        padding: 0;
        list-style: none;
      }
    }

    /* Responsive mobile (instruments) */
    @media (max-width: 768px) {
      .materiel-category.instruments {
        grid-column: 1; /* occupe juste sa colonne */
        grid-template-columns: 1fr; /* passe √† une seule colonne interne */
        gap: 1rem; /* un peu d‚Äôair entre les groupes */

        h2 {
          grid-column: 1;
        }
      }
    }
    .materiel-images {
      grid-column: span 3;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin: 1.5rem 0;

      img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 8px;
      }
    }

    .materiel-images-bottom {
      grid-column: span 3;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-top: 1.5rem;

      img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 8px;
      }
    }

    /* Responsive mobile */
    @media (max-width: 768px) {
      .materiel-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .materiel-images,
      .materiel-images-bottom {
        grid-column: 1;
        grid-template-columns: 1fr;
        
        img {
          height: 150px;
        }
      }
    }

    /* Responsive tablette */
    @media (min-width: 769px) and (max-width: 1023px) {
      .materiel-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .materiel-images,
      .materiel-images-bottom {
        grid-column: span 2;
      }
    }
  }
  @media (max-width: 768px) {
    .materiel-images.instrument-carousel,
    .materiel-images-bottom.instrument-carousel {
      display: flex !important;
      overflow-x: hidden;
      gap: 0;
      padding: 0;
    }

    .materiel-images.instrument-carousel img,
    .materiel-images-bottom.instrument-carousel img {
      flex: 0 0 100%;
      height: 150px;
      object-fit: cover;
      scroll-snap-align: start;
    }
    .instrument-carousel {
      display: flex !important;
      overflow-x: auto;
      scroll-snap-type: x mandatory; /* ‚úÖ snap automatique */
      -webkit-overflow-scrolling: touch;
    }

    .instrument-carousel img {
      flex: 0 0 100%;
      scroll-snap-align: start; /* chaque image s‚Äôaligne au d√©but */
    }
  }

</style>

  <!-- Script pour collapse/expand mobile avec activation DU BOUTON seulement c√¥t√© client -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const wrapper = document.querySelector(".videos-wrapper");
      if (!wrapper) return;

      const videos = wrapper.querySelector(".videos");
      const button = wrapper.querySelector(".toggle-videos");
      const icon = button?.querySelector("i");

      // MediaQuery et helper pour g√©rer l'affichage du bouton en live (resize)
      const mq = window.matchMedia("(max-width: 768px)");

      function updateVisibility() {
        if (mq.matches) {
          // mobile -> activer le bouton
          button.style.display = "flex";
          button.removeAttribute("aria-hidden");
        } else {
          // desktop -> masquer le bouton absolument, et reset l'√©tat
          button.style.display = "none";
          button.setAttribute("aria-hidden", "true");
          videos.classList.remove("expanded");
          // s'assurer que l'ic√¥ne est en √©tat plus
          if (icon) {
            icon.classList.remove("fa-minus");
            icon.classList.add("fa-plus");
          }
        }
      }

      // initial
      updateVisibility();

      // √©couter changement de breakpoint (responsive)
      if (typeof mq.addEventListener === "function") {
        mq.addEventListener("change", updateVisibility);
      } else if (typeof mq.addListener === "function") {
        mq.addListener(updateVisibility);
      }

      // click handler (ne sera utilisable que si le bouton est visible)
      button.addEventListener("click", (e) => {
        e.preventDefault();
        // si bouton cach√© pour une raison, on ignore
        if (getComputedStyle(button).display === "none") return;

        const expanded = videos.classList.toggle("expanded");

        // changer ic√¥ne + / -
        if (icon) {
          icon.classList.toggle("fa-plus", !expanded);
          icon.classList.toggle("fa-minus", expanded);
        }

        // smooth scroll vers la section quand on √©tend
        // if (expanded) {
        //   wrapper.scrollIntoView({ behavior: "smooth", block: "start" });
        // }
      });
    });

    document.addEventListener("DOMContentLoaded", () => {
      const wrapper = document.querySelector(".studio-wrapper");
      if (!wrapper) return;

      const gallery = wrapper.querySelector(".studio-gallery");
      const button = wrapper.querySelector(".toggle-studio");
      const icon = button.querySelector("i");
      const mq = window.matchMedia("(max-width: 768px)");

      function updateButtonVisibility() {
        if (mq.matches) {
          button.style.display = "flex";
        } else {
          button.style.display = "none";
          gallery.classList.remove("expanded");
          button.classList.remove("expanded");
          icon.classList.remove("fa-minus");
          icon.classList.add("fa-plus");
        }
      }

      updateButtonVisibility();
      mq.addEventListener("change", updateButtonVisibility);

      button.addEventListener("click", (e) => {
        e.preventDefault();
        const expanded = gallery.classList.toggle("expanded");

        if (expanded) {
          icon.className = "fa-solid fa-minus";
        } else {
          icon.className = "fa-solid fa-plus";
        }
      });
    });


    document.addEventListener("DOMContentLoaded", () => {
      const lightbox = document.getElementById("lightbox");
      const lightboxImg = lightbox.querySelector(".lightbox-img");
      const captionText = lightbox.querySelector(".lightbox-caption");
      const closeBtn = lightbox.querySelector(".close");

      document.querySelectorAll(".studio-item img").forEach(img => {
        img.addEventListener("click", () => {
          lightbox.style.display = "flex"; // bien flex pour centrer
          lightboxImg.src = img.src;
          captionText.textContent = img.closest(".studio-item").querySelector(".caption")?.textContent || img.alt;
        });
      });

      closeBtn.addEventListener("click", () => {
        lightbox.style.display = "none";
      });

      lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) lightbox.style.display = "none";
      });
    });

    // Animation des images du studio quand la section entre dans le viewport
    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const items = entry.target.querySelectorAll(".studio-item");
          items.forEach((item, index) => {
            setTimeout(() => item.classList.add("visible"), index * 150);
          });
          obs.unobserve(entry.target); // observe une seule fois
        }
      });
    }, { threshold: 0.2 });

    const gallery = document.querySelector(".studio-gallery");
    if (gallery) observer.observe(gallery);

    document.addEventListener("DOMContentLoaded", () => {
      const carousels = document.querySelectorAll('.instrument-carousel');

      carousels.forEach(carousel => {
        const mq = window.matchMedia("(max-width: 768px)");
        if (!mq.matches) return; // Desktop : rien √† faire

        const imgs = Array.from(carousel.querySelectorAll('img'));
        const total = imgs.length;

        // Cloner les images pour la boucle infinie
        imgs.forEach(img => {
          const clone = img.cloneNode(true);
          carousel.appendChild(clone);
        });

        let index = 0;
        const imgWidth = carousel.offsetWidth;

        // Scroll automatique
        let interval = setInterval(() => {
          index++;
          carousel.scrollTo({ left: imgWidth * index, behavior: 'smooth' });

          if (index >= total) {
            // reset invisible apr√®s animation
            setTimeout(() => {
              carousel.scrollLeft = 0;
              index = 0;
            }, 300); // dur√©e correspond √† smooth scroll
          }
        }, 3000);

        // Ajuster resize
        window.addEventListener('resize', () => {
          const newWidth = carousel.offsetWidth;
          carousel.scrollLeft = newWidth * index;
        });

        // Swipe manuel : reset index quand on swipe
        let isDragging = false;
        let startX = 0;

        carousel.addEventListener('touchstart', (e) => {
          isDragging = true;
          startX = e.touches[0].pageX;
        });

        carousel.addEventListener('touchmove', (e) => {
          if (!isDragging) return;
          const dx = startX - e.touches[0].pageX;
          carousel.scrollLeft += dx;
          startX = e.touches[0].pageX;
        });

        carousel.addEventListener('touchend', () => {
          isDragging = false;
          // recalculer l'index sur l'image la plus proche
          index = Math.round(carousel.scrollLeft / carousel.offsetWidth) % total;
          // forcer le scroll sur l'image exacte
          carousel.scrollTo({ left: carousel.offsetWidth * index, behavior: 'smooth' });
        });
      });
    });

  </script>
</Layout>