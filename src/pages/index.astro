---
import Navbar from "../components/Navbar.astro";
import Video from "../components/Video.astro";
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const data = await getCollection("videos");
---

<style lang="scss">
  @use "bulma/sass/layout/hero";
  @use "bulma/sass/layout/container";
  @use "bulma/sass/elements/title";

  .cover-image {
    background:
      linear-gradient(0deg, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 1) 100%),
      url("/website/cover.jpg") center/cover;
    text-align: center;
    font-weight: 700;

    h1,
    h2 {
      color: white;
    }
  }

  .videos-wrapper {
    .videos {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      transition: max-height 0.5s ease;
    }

    /* Par défaut on masque clairement le bouton (redondance CSS) */
    .toggle-videos {
      display: none !important;
      margin-top: 1rem;
      padding: 0.5rem 0.75rem;
      // background-color: #222;
      background: linear-gradient(45deg, #ea475f, #92dbf5);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      transition: background-color 0.2s ease;
    }

    .toggle-videos:hover {
      background-color: #444;
    }
  }

  /* Mobile : collapse et bouton visible */
  @media (max-width: 768px) {
    .videos-wrapper .videos {
      max-height: calc(3 * 180px + 1.5rem * 2); /* 3 vidéos + gaps */
      overflow: hidden;
    }

    .videos-wrapper .videos.expanded {
      max-height: 1000px; /* assez grand pour toutes les vidéos */
    }

    .videos-wrapper .toggle-videos {
      display: flex !important; /* visible uniquement sur mobile */
    }
  }
</style>

<Layout>
  <Navbar slot="navbar" />

  <!-- Cover modifiée -->
  <div class="hero cover-image">
    <div class="container hero-body">
      <h1 class="title">IN THE POUCHETT</h1>
      <h2 class="subtitle">Enregistrements, Mixages, Live Sessions</h2>
    </div>
  </div>

  <style lang="scss">
    .cover-image {
      background:
        linear-gradient(0deg, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 1) 100%),
        url("/website/cover.jpg") center/cover;
      text-align: center;
      font-weight: 700;

      /* Hauteur 3/4 sur desktop */
      min-height: 75vh;

      h1,
      h2 {
        color: white;
      }

      /* Centrage vertical Bulma-friendly */
      .hero-body {
        display: flex;
        flex-direction: column;
        justify-content: center; /* centre verticalement */
        align-items: center; /* centre horizontalement */
      }
        /* Ajustement des tailles de texte */
      .title {
        font-size: 4rem; /* Taille principale */
        line-height: 1.1;
      }

      .subtitle {
        font-size: 2rem;
        font-weight: 400;
        margin-top: 0.5rem;
      }
    }

    /* Mobile portrait : cover plus petite */
    @media (max-width: 768px) and (orientation: portrait) {
      .cover-image {
        min-height: 33vh; /* 1/3 de l’écran */
      }
      .title {
       font-size: 2.5rem !important;
      }

      .subtitle {
        font-size: 1.5rem !important;
      }
    }
  </style>

  <section class="pattern">
    <div class="container">
      <p>
        Situés dans le 17ème arrondissement de Paris, le studio In the Pouchett
        vous accueille pour accompagner vos projets musicaux. Studio orienté
        autour des Live Sessions, nous proposons cependant des services plus
        classiques tels que l'enregistrement, le mixage et le mastering de vos
        titres.
      </p>
      <p>
        Nous pouvons également apporter notre expertise musicale pour vous aider
        dans vos compositions et vous proposer des musiciens de session
        d'exception.
      </p>
    </div>
  </section>

  <!-- Section Références avec collapse sur mobile -->
  <section class="filled" id="reference">
    <h1>Références</h1>
    <div class="container">
      <div class="videos-wrapper">
        <div class="videos">
          {data.map((i) => <Video url={i.data.url} />)}
        </div>

        <!--
          Bouton REELLEMENT masqué par défaut via inline style.
          Le script ci-dessous l'affichera uniquement si l'écran est mobile.
        -->
        <button class="toggle-videos" style="display:none;" aria-hidden="true">
          <i class="fa-solid fa-plus" aria-hidden="true"></i>
        </button>
      </div>

      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus.
        Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies
        sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius
        a, semper congue, euismod non, mi.
      </p>
    </div>
  </section>

  <h1 class="pattern" id="studio">Le studio</h1>
  <section class="filled">
    <div class="container">
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus.
        Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies
        sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius
        a, semper congue, euismod non, mi.
      </p>
    </div>
  </section>

  <h1 class="pattern" id="materiel">Le matériel</h1>
  <section class="filled">
    <div class="container">
      <p>
        Microphones (dynamique, à condensateur, à ruban) - Préamplificateurs -
        Interfaces audio - Moniteurs de studio - Casques de studio - Claviers
        MIDI - Instruments (guitares, claviers, percussions, etc.) -
        Enregistreurs multipistes - Logiciels de production musicale (DAW) -
        Plugins audio (effets, instruments virtuels) - Câbles audio (XLR, jack,
        MIDI) - Panneaux acoustiques - Supports de microphone - Table de mixage
        - DI boxes (boîtes de direct) - Enceintes de monitoring - Systèmes de
        traitement du son - Accessoires divers (pieds de micro, filtres
        anti-pop, etc.)
      </p>
    </div>
  </section>

  <!-- Script pour collapse/expand mobile avec activation DU BOUTON seulement côté client -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const wrapper = document.querySelector(".videos-wrapper");
      if (!wrapper) return;

      const videos = wrapper.querySelector(".videos");
      const button = wrapper.querySelector(".toggle-videos");
      const icon = button?.querySelector("i");

      // MediaQuery et helper pour gérer l'affichage du bouton en live (resize)
      const mq = window.matchMedia("(max-width: 768px)");

      function updateVisibility() {
        if (mq.matches) {
          // mobile -> activer le bouton
          button.style.display = "flex";
          button.removeAttribute("aria-hidden");
        } else {
          // desktop -> masquer le bouton absolument, et reset l'état
          button.style.display = "none";
          button.setAttribute("aria-hidden", "true");
          videos.classList.remove("expanded");
          // s'assurer que l'icône est en état plus
          if (icon) {
            icon.classList.remove("fa-minus");
            icon.classList.add("fa-plus");
          }
        }
      }

      // initial
      updateVisibility();

      // écouter changement de breakpoint (responsive)
      if (typeof mq.addEventListener === "function") {
        mq.addEventListener("change", updateVisibility);
      } else if (typeof mq.addListener === "function") {
        mq.addListener(updateVisibility);
      }

      // click handler (ne sera utilisable que si le bouton est visible)
      button.addEventListener("click", (e) => {
        e.preventDefault();
        // si bouton caché pour une raison, on ignore
        if (getComputedStyle(button).display === "none") return;

        const expanded = videos.classList.toggle("expanded");

        // changer icône + / -
        if (icon) {
          icon.classList.toggle("fa-plus", !expanded);
          icon.classList.toggle("fa-minus", expanded);
        }

        // smooth scroll vers la section quand on étend
        if (expanded) {
          wrapper.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      });
    });
  </script>
</Layout>
