---
import { Picture } from "astro:assets";
import Navbar from "../components/Navbar.astro";
import Layout from "../layouts/Layout.astro";
//import YouTubeGrid from "../components/YouTubeGrid.astro";

// --- IMPORTS DES IMAGES ---
import liveSessCover from "../assets/live-sess-cover-small.jpg";
import classicLiveSess from "../assets/classic-live-sess.jpg";
import liveConcert from "../assets/live-concert.jpg";
import customLiveSess from "../assets/custom-live-sess.jpg";

function ensureTrailing(href: string) {
  if (!href) return href;
  if (href.startsWith('http') || href.startsWith('mailto:') || href.startsWith('tel:')) return href;
  if (href.startsWith('#')) return href;
  const [base, hash] = href.split('#');
  let b = base || '/';
  if (!b.startsWith('/')) b = '/' + b;
  if (b !== '/' && !b.endsWith('/')) b = b + '/';
  return hash ? `${b}#${hash}` : b;
}
---

<style is:global lang="scss">
  @use "bulma/sass/layout/hero";
  @use "bulma/sass/layout/container";
  @use "bulma/sass/elements/title";

  /* RESET */
  *,
  *::before,
  *::after { box-sizing: border-box; }

  main a {
    color: inherit;
    text-decoration: underline;
  }

  main a:hover {
    color: inherit;
    text-decoration-thickness: 2px;
  }

  /* wrapper interne centré */
  .diffusion-inner {
    display: flex;
    flex-wrap: nowrap;
    gap: 1.5rem;
    align-items: flex-start;
    justify-content: flex-start;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    box-sizing: border-box;
  }

  .diffusion-inner > * { min-width: 0; }

  .diffusion-text {
    flex: 1 1 60%;
    min-width: 0;
  }

  .diffusion-video-wrapper {
    flex: 0 0 36%;
    max-width: 420px;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    align-items: flex-start;
    box-sizing: border-box;
  }

  .video-embed {
    width: 100%;
    aspect-ratio: 16 / 9;
    overflow: hidden;
    background: #000;
    border-radius: 6px;
  }

  .video-embed iframe {
    width: 100%;
    height: 100%;
    border: 0;
    display: block;
  }

  .youtube-btn {
    display: inline-flex;
    align-items: center;
    gap: .5rem;
    padding: .6rem 1rem;
    border-radius: .5rem;
    text-decoration: none;
    align-self: flex-start;
  }

  /* ========== MOBILE / TABLETTE ========== */
  @media (max-width: 992px) {
    .diffusion-inner {
      flex-direction: column;
      align-items: center;
      gap: 1.25rem;
      max-width: 900px;
      padding: 0 1rem;
    }

    .diffusion-text,
    .diffusion-video-wrapper {
      flex: 1 1 100%;
      max-width: 100%;
      min-width: 0;
      text-align: center;
    }

    .diffusion-video-wrapper {
      align-items: center;
    }

    .youtube-btn { align-self: center; }

    .video-embed { width: 100%; max-width: 900px; }
  }
  
  /* Style Cover optimisée */
  .cover-image {
    background: linear-gradient(0deg, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 1) 100%);
    text-align: center;
    font-weight: 700;
    position: relative; 

    h1,
    h2 {
      color: white;
    }
  }

  .cover-background-img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: -1;
    filter: brightness(0.75);
  }

  .youtube-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    font-size: 1.1rem;
    font-weight: 600;
    color: #fff;
    background: linear-gradient(90deg, #ff0000 0%, #e52d27 100%);
    border: 2px solid #ff0000;
    border-radius: 0.5rem;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .youtube-btn:hover {
    background: #fff;
    color: #ff0000;
    border-color: #ff0000;
    transform: translateY(-2px);
    box-shadow: 0 6px 10px rgba(0,0,0,0.15);
  }

  .youtube-btn .icon {
    font-size: 1.4rem;
  }
  
  /* GRID DES FORMATS */
  .formats-grid {
      display: flex;
      gap: 1.5rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;

      /* NOTE: Les styles de base de .format-card (fond blanc, animation, ombre) 
         sont gérés globalement dans Layout.astro. 
         Ici, on ne gère que la mise en page (Flexbox) et l'aspect-ratio de l'image. */

      .format-card {
        flex: 1 1 calc(33.333% - 1rem); /* 3 cartes par ligne */
        min-width: 280px;

        /* On cible l'image pour forcer le format carré */
        .card-image {
          aspect-ratio: 1 / 1; 
          overflow: hidden;

          /* S'assurer que le Picture et l'img remplissent bien le carré */
          picture, img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
          }
        }
      }

      @media (max-width: 992px) {
        justify-content: center;
        .format-card {
            flex: 1 1 calc(50% - 1rem); /* 2 cartes sur tablette */
            max-width: 400px;
        }
      }
      @media (max-width: 600px) {
        .format-card {
            flex: 1 1 100%; /* 1 carte sur mobile */
            max-width: 100%;
        }
      }
  }
</style>

<Layout title="Live Sessions — In the Pouchett" description="Live Sessions au studio In the Pouchett — captation, mixage, mastering et production vidéo à Paris." canonical="/live-sessions/">
  <Navbar slot="navbar" />
  
  <div class="hero is-medium cover-image">
    <Picture
      src={liveSessCover}
      alt="Live Sessions Cover"
      widths={[600, 1200, 1800]}
      sizes="100vw"
      class="cover-background-img"
    />
    <div class="container hero-body">
      <h1 class="title">LIVE SESSIONS</h1>
      <h2 class="subtitle">Captation, Mixage, Mastering, Edition, Colorimétrie</h2>
    </div>
  </div>
  
  <section class="filled">
      <div class="container">
        <p>
          Le studio In the Pouchett est spécialisé dans la réalisation de Live Sessions.
          Nous proposons un service complet allant de la captation audio et vidéo à la
          post-production (mixage, mastering, édition et colorimétrie).<br />

          L'enregistrement se déroule dans un cadre chaleureux et intimiste, idéal pour livrer votre meilleure performance.
        </p>
      </div>
  </section>
  <section class="pattern">
      <div class="container">
        <p>
          Nous pouvons accueillir jusqu'à 7 musicien·nes simultanément avec retours casques indépendants.
          Notre plateau est modulable et s'adaptera à chaque projet de création et à chaque formation musicale.<br />
          De plus nous mettons à disposition tout le matériel et instruments dont nous disposons (cf. section <a href={ensureTrailing('/') + '#materiel'}>Le Matériel</a>).
        </p>
      </div>
  </section>

  <section class="filled" id="formats">
    <h1>Formats</h1>
    <div class="container">
      <div class="formats-grid">
        
        <div class="format-card">
          <div class="card-image">
            <Picture
              src={classicLiveSess}
              alt="Live in the Pouchett"
              widths={[300, 600]}
              sizes="(max-width: 768px) 90vw, 300px"
            />
          </div>
          <div class="card-content">
            <h3><strong>Format <i>Live in the Pouchett</i></strong></h3>
            <p>
              Le format “classique” d'une captation live.  
              Possibilité de refaire plusieurs prises pour garantir la meilleure qualité, 
              avec des plans d'inserts pour enrichir le rendu visuel.
            </p>
          </div>
        </div>

        <div class="format-card">
          <div class="card-image">
            <Picture
              src={liveConcert}
              alt="Concert in the Pouchett"
              widths={[300, 600]}
              sizes="(max-width: 768px) 90vw, 300px"
            />
          </div>
          <div class="card-content">
            <h3><strong>Format <i>Concert in the Pouchett</i></strong></h3>
            <p>
              Une expérience plus spontanée et énergique.  
              Petit public (≈10 personnes) pour recréer l'ambiance d'un concert intimiste, 
              capté en one-shot sur une vingtaine de minutes.
            </p>
          </div>
        </div>

        <div class="format-card">
          <div class="card-image">
            <Picture
              src={customLiveSess}
              alt="Format Custom"
              widths={[300, 600]}
              sizes="(max-width: 768px) 90vw, 300px"
            />
          </div>
          <div class="card-content">
            <h3><strong>Format <i>Custom</i></strong></h3>
            <p>
              Un projet particulier en tête ? Envie de filmer dans un lieu spécifique ? 
              Nous concevons avec vous un format sur-mesure, adapté à votre univers.
            </p>
          </div>
        </div>

      </div>
    </div>
  </section>

  <section class="pattern" id="diffusion">
    <h1>Diffusion</h1>
    <div class="container">
      <div class="diffusion-inner">
        <div class="diffusion-text">
          <p>
            Chez ITP, nous avons fait le choix de centraliser la diffusion de nos Live Sessions afin de bâtir une véritable communauté autour du studio.  
            Chaque session est ainsi mise en valeur sur notre chaîne YouTube et nos réseaux sociaux, pour maximiser son impact et toucher un public déjà engagé.  
            Pour prolonger cette visibilité, nous pouvons également vous offrir la possibilité de partager un ou deux titres de la session sur votre propre chaîne, afin de créer du lien direct avec vos abonnés.  
            Et si vous souhaitez aller plus loin, des options de diffusion élargie peuvent être envisagées ensemble.
          </p>
        </div>

        <div class="diffusion-video-wrapper">
          <a 
            href="https://www.youtube.com/@inthepouchett?sub_confirmation=1" 
            target="_blank" 
            rel="noopener noreferrer"
            class="youtube-btn"
          >
            <span class="icon"><i class="fab fa-youtube"></i></span>
            <span>Notre chaîne YouTube</span>
          </a>

          <div class="video-embed">
            <iframe 
              src="https://www.youtube.com/embed/videoseries?si=G4ySTrE8hW2nuyV5&amp;list=PLOso5G9jp8_Bz3MI54AVnI6T_mRsqTU0P" 
              title="YouTube video player"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin"
              allowfullscreen>
            </iframe>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="filled" id="tarifs">
    <h1>Tarifs</h1>
    <div class="container">
      <p>
        Nos tarifs sont adaptés en fonction du format choisi et des services inclus. 
        N'hésitez pas à nous contacter pour obtenir un devis personnalisé.
      </p>
    </div>
  </section>
</Layout>